<script>
    async function downloadVideo() {
        const url = document.getElementById('url').value;
        if (!url) {
            alert('لطفا لینک را وارد کنید');
            return;
        }

        const progressBar = document.getElementById('progress-bar');
        const progressFill = document.getElementById('progress-fill');
        progressBar.style.display = 'block';

        let progress = 0;
        const progressInterval = setInterval(() => {
            if (progress >= 100) {
                clearInterval(progressInterval);
            } else {
                progress += 10;
                progressFill.style.width = progress + '%';
            }
        }, 100);

        try {
            const response = await fetch(`https://api.bhawanigarg.com/social/instagram/?url=${encodeURIComponent(url)}`);
            if (!response.ok) {
                throw new Error('خطا در برقراری ارتباط با سرور');
            }
            const data = await response.json();

            console.log(data); // مشاهده کامل داده‌های API

            if (data.status === 200 && data.result) {
                const media = data.result.media || []; // از "media" محافظت می‌کنیم
                let output = '';
                media.forEach(item => {
                    if (item.type === 'video') {
                        output += `<p>ویدیو: <a href="${item.url}" download>دانلود</a></p>`;
                    } else if (item.type === 'photo') {
                        output += `<p>عکس: <a href="${item.url}" download>دانلود</a></p>`;
                    }
                });
                document.getElementById('result').innerHTML = output || 'محتوایی برای نمایش یافت نشد.';
            } else {
                document.getElementById('result').innerHTML = 'ویدیو یافت نشد یا امکان دانلود وجود ندارد.';
            }
        } catch (error) {
            document.getElementById('result').innerHTML = `خطا: ${error.message}`;
        }
    }
</script>
